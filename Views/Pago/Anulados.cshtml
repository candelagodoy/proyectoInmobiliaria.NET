@model IEnumerable<proyectoInmobiliaria.NET.Models.Pago>

@{
    ViewData["Title"] = "Pagos anulados";
    var esAdmin = User?.Identity?.IsAuthenticated == true && User.IsInRole("Administrador");
    var hayBaja = Model != null && Model.Any(p => p.idUsuarioBaja != 0);
}

<div class="container-xxl py-3">
    <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
            <h1 class="h5 mb-0 fw-semibold">Pagos anulados</h1>
        </div>

        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr class="text-uppercase small text-secondary">
                            <th>@Html.DisplayNameFor(m => m.First().descripcion)</th>
                            <th class="text-end">@Html.DisplayNameFor(m => m.First().numPago)</th>
                            <th class="text-end">@Html.DisplayNameFor(m => m.First().idContrato)</th>
                            <th class="text-nowrap">@Html.DisplayNameFor(m => m.First().fechaPago)</th>
                            <th class="text-end">@Html.DisplayNameFor(m => m.First().importe)</th>
                            <th class="text-end">@Html.DisplayNameFor(m => m.First().estado)</th>

                            @if (esAdmin)
                            {
                                <th class="text-end">@Html.DisplayNameFor(m => m.First().idUsuarioAlta)</th>
                                <th class="text-end">
                                    @(hayBaja ? Html.DisplayNameFor(m => m.First().idUsuarioBaja).ToString() : "No se anuló el pago")
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@Html.DisplayFor(_ => item.descripcion)</td>
                                <td class="text-end">@Html.DisplayFor(_ => item.numPago)</td>
                                <td class="text-end">@Html.DisplayFor(_ => item.idContrato)</td>
                                <td class="text-nowrap">@item.fechaPago.ToString("dd/MM/yyyy")</td>
                                <td class="text-end">@Html.DisplayFor(_ => item.importe)</td>
                                <td class="text-end">@(item.estado ? "Vigente" : "Anulado")</td>

                                @if (esAdmin)
                                {
                                    <td class="text-end">@Html.DisplayFor(_ => item.idUsuarioAlta)</td>
                                    <td class="text-end">
                                        @(item.idUsuarioBaja != 0 ? item.idUsuarioBaja.ToString() : "—")
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-footer d-flex justify-content-end">
            <a class="btn btn-outline-info" asp-action="Index">Regresar</a>
        </div>
    </div>
</div>
